# üêüüçéüóë Fish macOS Trash

[Fish](https://fishshell.com/) plugin for macOS Trash.

- Move files to the Trash, supports **Put Back**
- List files in the Trash
- Empty the Trash

## Installation

Fish 3.2.0 or above is required.

- [plug.fish](https://github.com/kidonng/plug.fish)

  ```sh
  plug install kidonng/fish-macos-trash
  ```

- [Fisher](https://github.com/jorgebucaran/fisher)

  ```sh
  fisher install kidonng/fish-macos-trash
  ```

## Usage

### `trash <files>`

Move files to the Trash.

- `--verbose` / `-v` shows files being trashed.

### `trash --list/-l`

List files in the Trash.

- `--verbose` / `-v` shows each file's size (via `du -hcs`).

### `trash --empty/-e`

Empty the Trash.

- This operation prompts for confirmation before proceeding.

## Motivation

When this plugin is created, there are 3 trash tools on Homebrew, each with its own issues:

- [trash](https://hasseg.org/trash/)
  - Does not request **Automation** permission in some programs, such as Visual Studio Code's built-in terminal (though can be easily fixed by manually running `osascript`)
  - Slow when listing files in the Trash
  - ~~Too much code for a small utility~~
- [macos-trash](https://github.com/sindresorhus/macos-trash): does not support **Put Back** on macOS 10.15 and above

  Note: this also powers the npm package [`trash`](https://github.com/sindresorhus/trash).

- [trash-cli](https://github.com/andreafrancia/trash-cli)
  - [Does not use macOS trash](https://github.com/andreafrancia/trash-cli/issues/127)
  - [Does not run if installed with Homebrew](https://github.com/andreafrancia/trash-cli/issues/183)

Oh My Fish [`osx` plugin](https://github.com/oh-my-fish/plugin-osx) (which provides `trash` function) doesn't support **Put Back** either.

## Performance

This plugin uses [AppleScript](https://developer.apple.com/library/archive/documentation/AppleScript/Conceptual/AppleScriptLangGuide/introduction/ASLR_intro.html), which is the best way to interact with macOS but may not be performant.

Rudimentary testing with `touch (seq <num>) && time trash *` (keep in mind that this is approximately **the same speed as trashing in Finder**.):

- 100 files

  ```
  Executed in    1.46 secs      fish           external
    usr time  100.36 millis   37.91 millis   62.45 millis
    sys time   41.69 millis   11.39 millis   30.30 millis
  ```

- 1000 files

  ```
  Executed in    9.59 secs    fish           external
     usr time    1.03 secs  726.86 millis  306.00 millis
     sys time    0.15 secs  109.84 millis   36.40 millis
  ```

- 3000 files

  ```
  Executed in   37.26 secs    fish         external
    usr time    5.73 secs    4.74 secs  987.29 millis
    sys time    0.54 secs    0.49 secs   48.48 millis
  ```

- 10000 files

  `Stack overflow` after about 75 seconds

### What if I want to trash lots of files?

- Such amount of files are most likely generated by programs, and can be easily regenerated, so just `rm` them away like a pro.
- If you do want to keep them, `mv` them to a folder and trash the folder instead. This also prevents the files from cluttering the Trash.
