# üêüüçéüóë Fish macOS Trash

Move to, view and empty macOS Trash. Powered by [AppleScript](https://developer.apple.com/library/archive/documentation/AppleScript/Conceptual/AppleScriptLangGuide/introduction/ASLR_intro.html).

## Usage

With [Fisher](https://github.com/jorgebucaran/fisher):

```sh
fisher install kidonng/fish-macos-trash
```

- `trash` move files to the Trash
  - `-v/--verbose` show files to be trashed
  - **NOTE** Avoid operating on too many files, see [Performance](#performance)
- `trash -l/--list` list files in the Trash
  - `-v/--verbose` show file count and total size
  - Control the list command via `$list_trash` (default: `ls -A`)
- `trash -e/--empty` empty the Trash

## Comparison with similar tools

There are currently 3 trash tools on Homebrew:

- [trash](https://hasseg.org/trash/): this one works well and I had been using it for some time. Though some minor issues eventually made me to write this plugin:
  - It doesn't request **Automation** permission in Visual Studio Code's builtin terminal. This can be easily fixed (for example run this plugin once), but it is really confusing.
  - It can list files in the Trash, which is good, but it is even slower that trashing files via Finder. I have no idea why.
  - It's a lof of code (mostly headers) which is ridiculous for a small utility. This plugin is ~60 LOC, easy to read and modify.
- [macos-trash](https://github.com/sindresorhus/macos-trash): this one's **Put Back** support is completely broken on macOS 10.15 and above.

  Note this is also the underlying program of the npm package [`trash`](https://github.com/sindresorhus/trash).

- [trash-cli](https://github.com/andreafrancia/trash-cli): it [follows XDG specs](https://github.com/andreafrancia/trash-cli/issues/127) and doesn't use macOS trash. Plus it [doesn't run if installed with Homebrew](https://github.com/andreafrancia/trash-cli/issues/183).

### But I don't use Fish!

As this plugin is created, it is one of the few projects that uses macOS Trash and supports **Put Back**. So what to do if you want to use it?

- [Switch to Fish now](https://fishshell.com/) üêü.
- Make a port, which should be easy.

## Performance

This plugin calls Finder to trash files, however Finder itself is not very fast. Trashing a lots files can take a long time or even fail.

The following benchmarks are generated with `touch (seq <num>) && time trash *` on [my machine](https://github.com/kidonng/HP-Pavilion-13-Hackintosh).

- 100 files

  ```
  Executed in    1.46 secs      fish           external
    usr time  100.36 millis   37.91 millis   62.45 millis
    sys time   41.69 millis   11.39 millis   30.30 millis
  ```

- 1000 files

  ```
  Executed in    9.59 secs    fish           external
     usr time    1.03 secs  726.86 millis  306.00 millis
     sys time    0.15 secs  109.84 millis   36.40 millis
  ```

- 3000 files

  ```
  Executed in   37.26 secs    fish         external
    usr time    5.73 secs    4.74 secs  987.29 millis
    sys time    0.54 secs    0.49 secs   48.48 millis
  ```

- 10000 files

  `Stack overflow` after ~75s

Keep in mind that this is approximately **the same speed as you trash the files in Finder manually**.

Solutions:

- This amount of files are most likely to be generated by software, and they will crowd your trash bin. Just `rm` them away like a pro.
- If you do need to keep these files, `mv` theme to a folder and trash the folder instead.
